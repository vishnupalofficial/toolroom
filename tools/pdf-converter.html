<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Converter Pro - Premium Quality Conversion</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            background-size: 200% 200%;
            animation: gradientMove 15s ease infinite;
            min-height: 100vh;
            padding: 30px 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.05) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(255,255,255,0.03) 0%, transparent 50%);
            pointer-events: none;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            animation: fadeInUp 0.8s ease-out;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .logo {
            font-size: 60px;
            filter: drop-shadow(0 5px 20px rgba(255,255,255,0.3));
        }

        .brand-name {
            font-size: 2.8em;
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
        }

        .pro-badge {
            display: inline-block;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
            margin-left: 10px;
        }

        .tagline {
            font-size: 1.1em;
            color: rgba(255,255,255,0.9);
            font-weight: 500;
            margin-top: 10px;
        }

        .features-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }

        .feature-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .feature-card h3 {
            color: white;
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .feature-card p {
            color: rgba(255,255,255,0.8);
            font-size: 13px;
        }

        .main-card {
            background: white;
            border-radius: 25px;
            padding: 45px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .main-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #7e22ce, transparent);
            animation: shimmer 3s infinite;
        }

        .tabs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 40px;
            background: #f8fafc;
            padding: 6px;
            border-radius: 15px;
        }

        .tab {
            padding: 16px 24px;
            background: transparent;
            border: none;
            font-size: 16px;
            font-weight: 700;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
        }

        .tab.active {
            background: linear-gradient(135deg, #1e3c72 0%, #7e22ce 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(126, 34, 206, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.5s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        .upload-zone {
            border: 3px dashed #cbd5e1;
            border-radius: 20px;
            padding: 60px 30px;
            text-align: center;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 25px;
        }

        .upload-zone:hover {
            border-color: #7e22ce;
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            transform: scale(1.01);
        }

        .upload-zone.dragover {
            border-color: #7e22ce;
            background: #faf5ff;
            box-shadow: 0 0 0 4px rgba(126, 34, 206, 0.1);
        }

        .upload-icon {
            font-size: 70px;
            margin-bottom: 20px;
        }

        .upload-zone h3 {
            color: #1e293b;
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .upload-zone p {
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
        }

        input[type="file"] {
            display: none;
        }

        .file-info-box {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
            border: 2px solid #e2e8f0;
        }

        .file-info-box.show {
            display: block;
        }

        .file-name {
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 5px;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-size {
            color: #64748b;
            font-size: 13px;
            font-weight: 500;
        }

        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px;
            margin-top: 15px;
            max-height: 280px;
            overflow-y: auto;
        }

        .image-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
        }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-img {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .remove-img:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .input-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
            border: 2px solid #e2e8f0;
        }

        .input-section.show {
            display: block;
        }

        .input-section label {
            display: block;
            margin-bottom: 10px;
            color: #1e293b;
            font-weight: 700;
            font-size: 14px;
        }

        .input-field {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #7e22ce;
            box-shadow: 0 0 0 3px rgba(126, 34, 206, 0.1);
        }

        .quality-box {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
            border: 2px solid #e2e8f0;
        }

        .quality-box.show {
            display: block;
        }

        .quality-box h4 {
            margin-bottom: 15px;
            color: #1e293b;
            font-size: 15px;
            font-weight: 700;
        }

        .quality-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .quality-btn {
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
            font-size: 13px;
            background: white;
        }

        .quality-btn:hover {
            border-color: #7e22ce;
            background: #faf5ff;
        }

        .quality-btn.selected {
            border-color: #7e22ce;
            background: linear-gradient(135deg, #7e22ce 0%, #6b21a8 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(126, 34, 206, 0.3);
        }

        .extract-box {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
            border: 2px solid #e2e8f0;
        }

        .extract-box.show {
            display: block;
        }

        .extract-box h4 {
            margin-bottom: 15px;
            color: #1e293b;
            font-size: 15px;
            font-weight: 700;
        }

        .extract-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 10px;
        }

        .extract-btn {
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
            font-size: 13px;
            background: white;
        }

        .extract-btn:hover {
            border-color: #7e22ce;
            background: #faf5ff;
        }

        .extract-btn.selected {
            border-color: #7e22ce;
            background: linear-gradient(135deg, #7e22ce 0%, #6b21a8 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(126, 34, 206, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .create-btn {
            flex: 1;
            padding: 18px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .create-btn.show {
            display: block;
        }

        .create-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(16, 185, 129, 0.4);
        }

        .create-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .new-file-btn {
            padding: 18px 30px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
            white-space: nowrap;
        }

        .new-file-btn.show {
            display: block;
        }

        .new-file-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(239, 68, 68, 0.4);
        }

        .loading-box {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loading-box.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f1f5f9;
            border-top: 4px solid #7e22ce;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        .loading-box p {
            font-weight: 600;
            color: #64748b;
            font-size: 15px;
        }

        .message-box {
            margin-top: 20px;
            padding: 18px;
            border-radius: 12px;
            display: none;
            font-weight: 600;
            font-size: 14px;
        }

        .message-box.show {
            display: block;
        }

        .message-box.success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border: 2px solid #6ee7b7;
        }

        .message-box.error {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 2px solid #fca5a5;
        }

        .formats-section {
            margin-top: 35px;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
        }

        .formats-section h4 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: 700;
            text-align: center;
        }

        .formats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
        }

        .format-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            color: #1e293b;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .format-card:hover {
            border-color: #7e22ce;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(126, 34, 206, 0.15);
        }

        @media (max-width: 768px) {
            .brand-name {
                font-size: 2em;
            }
            
            .main-card {
                padding: 30px 20px;
            }
            
            .quality-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .new-file-btn {
                white-space: normal;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div class="logo">📄</div>
                <div>
                    <div style="display: flex; align-items: center; justify-content: center;">
                        <span class="brand-name">ToolRoom</span>
                        <span class="pro-badge">PRO</span>
                    </div>
                    <p class="tagline">Professional PDF Converter</p>
                </div>
            </div>
        </div>

        <div class="features-bar">
            <div class="feature-card">
                <div class="feature-icon">⚡</div>
                <h3>Ultra Fast</h3>
                <p>Lightning speed processing</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🎯</div>
                <h3>High Quality</h3>
                <p>Premium output guaranteed</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🔒</div>
                <h3>100% Secure</h3>
                <p>All data stays local</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🚀</div>
                <h3>No Limits</h3>
                <p>Unlimited conversions</p>
            </div>
        </div>

        <div class="main-card">
            <div class="tabs">
                <button class="tab active" data-tab="toPdf">📤 Convert to PDF</button>
                <button class="tab" data-tab="fromPdf">📥 Extract from PDF</button>
            </div>

            <div id="toPdfTab" class="tab-content active">
                <div class="upload-zone" id="uploadZone1">
                    <div class="upload-icon">📁</div>
                    <h3>Drop Your Files Here</h3>
                    <p>Word, Excel, Images (Max 10000) • Drag & Drop or Click</p>
                    <input type="file" id="fileInput1" accept=".docx,.xlsx,.xls,.jpg,.jpeg,.png,.gif" multiple>
                </div>

                <div class="file-info-box" id="fileInfo1">
                    <div class="file-name" id="fileName1"></div>
                    <div class="file-size" id="fileSize1"></div>
                    <div class="images-grid" id="imagesGrid"></div>
                </div>

                <div class="input-section" id="nameSection1">
                    <label for="outputName1">📝 Output Filename (Optional)</label>
                    <input type="text" id="outputName1" class="input-field" placeholder="Leave empty for auto naming (ToolRoom_Document)">
                </div>

                <div class="quality-box" id="qualityBox">
                    <h4>⚙️ Quality Settings</h4>
                    <div class="quality-grid">
                        <div class="quality-btn" data-quality="standard">
                            <div>📄 Standard</div>
                            <div style="font-size: 11px; opacity: 0.8;">Good</div>
                        </div>
                        <div class="quality-btn selected" data-quality="high">
                            <div>⭐ High</div>
                            <div style="font-size: 11px; opacity: 0.8;">Better</div>
                        </div>
                        <div class="quality-btn" data-quality="ultra">
                            <div>💎 Ultra</div>
                            <div style="font-size: 11px; opacity: 0.8;">Best</div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="create-btn" id="createBtn1">✨ Create PDF</button>
                    <button class="new-file-btn" id="newFileBtn1">🔄 New File</button>
                </div>

                <div class="loading-box" id="loading1">
                    <div class="spinner"></div>
                    <p>Creating premium PDF...</p>
                </div>

                <div class="message-box" id="message1"></div>

                <div class="formats-section">
                    <h4>✨ Supported Formats</h4>
                    <div class="formats-grid">
                        <div class="format-card">📝 Word (.docx)</div>
                        <div class="format-card">📊 Excel (All Sheets)</div>
                        <div class="format-card">🖼️ Images (Max 10000)</div>
                    </div>
                </div>
            </div>

            <div id="fromPdfTab" class="tab-content">
                <div class="upload-zone" id="uploadZone2">
                    <div class="upload-icon">📄</div>
                    <h3>Upload Your PDF</h3>
                    <p>Extract to Text, Word, Excel or Images</p>
                    <input type="file" id="fileInput2" accept=".pdf">
                </div>

                <div class="file-info-box" id="fileInfo2">
                    <div class="file-name" id="fileName2"></div>
                    <div class="file-size" id="fileSize2"></div>
                </div>

                <div class="extract-box" id="extractBox">
                    <h4>📤 Extract Format</h4>
                    <div class="extract-grid">
                        <div class="extract-btn selected" data-format="text">📝 Text</div>
                        <div class="extract-btn" data-format="word">📄 Word</div>
                        <div class="extract-btn" data-format="excel">📊 Excel</div>
                        <div class="extract-btn" data-format="images">🖼️ Images</div>
                    </div>
                </div>

                <div class="input-section" id="nameSection2">
                    <label for="outputName2">📝 Output Filename (Optional)</label>
                    <input type="text" id="outputName2" class="input-field" placeholder="Leave empty for auto naming (ToolRoom_Extracted)">
                </div>

                <div class="action-buttons">
                    <button class="create-btn" id="createBtn2">✨ Extract Content</button>
                    <button class="new-file-btn" id="newFileBtn2">🔄 New File</button>
                </div>

                <div class="loading-box" id="loading2">
                    <div class="spinner"></div>
                    <p>Extracting content...</p>
                </div>

                <div class="message-box" id="message2"></div>

                <div class="formats-section">
                    <h4>✨ Extraction Options</h4>
                    <div class="formats-grid">
                        <div class="format-card">📝 Text (.txt)</div>
                        <div class="format-card">📄 Word (.doc)</div>
                        <div class="format-card">📊 Excel (.xlsx)</div>
                        <div class="format-card">🖼️ Images (.zip)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const jsPDF = window.jspdf.jsPDF;
        let selectedFiles = [];
        let selectedFile2 = null;
        let qualityLevel = 'high';
        let extractFormat = 'text';

        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(targetTab + 'Tab').classList.add('active');
                });
            });

            // Quality selection
            document.querySelectorAll('.quality-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    qualityLevel = this.getAttribute('data-quality');
                    document.querySelectorAll('.quality-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Extract format selection
            document.querySelectorAll('.extract-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    extractFormat = this.getAttribute('data-format');
                    document.querySelectorAll('.extract-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Upload zones
            document.getElementById('uploadZone1').addEventListener('click', function(e) {
                if (!e.target.classList.contains('remove-img')) {
                    document.getElementById('fileInput1').click();
                }
            });

            document.getElementById('uploadZone2').addEventListener('click', function() {
                document.getElementById('fileInput2').click();
            });

            // File inputs
            document.getElementById('fileInput1').addEventListener('change', function(e) {
                handleFileSelect(Array.from(e.target.files), 1);
            });

            document.getElementById('fileInput2').addEventListener('change', function(e) {
                if (e.target.files[0]) {
                    handleFileSelect([e.target.files[0]], 2);
                }
            });

            // Drag and drop
            ['uploadZone1', 'uploadZone2'].forEach(id => {
                const zone = document.getElementById(id);
                
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('dragover');
                });

                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('dragover');
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('dragover');
                    const num = id === 'uploadZone1' ? 1 : 2;
                    const files = num === 1 ? Array.from(e.dataTransfer.files) : [e.dataTransfer.files[0]];
                    handleFileSelect(files, num);
                });
            });

            // Create buttons
            document.getElementById('createBtn1').addEventListener('click', convertToPdf);
            document.getElementById('createBtn2').addEventListener('click', extractFromPdf);
            
            // New file buttons
            document.getElementById('newFileBtn1').addEventListener('click', function() {
                resetUI(1);
            });
            document.getElementById('newFileBtn2').addEventListener('click', function() {
                resetUI(2);
            });
        });

        function resetUI(num) {
            document.getElementById(`fileInfo${num}`).classList.remove('show');
            document.getElementById(`nameSection${num}`).classList.remove('show');
            document.getElementById(`createBtn${num}`).classList.remove('show');
            document.getElementById(`newFileBtn${num}`).classList.remove('show');
            document.getElementById(`message${num}`).classList.remove('show');
            document.getElementById(`loading${num}`).classList.remove('show');
            document.getElementById(`outputName${num}`).value = '';
            document.getElementById(`fileInput${num}`).value = '';
            
            if (num === 1) {
                document.getElementById('qualityBox').classList.remove('show');
                document.getElementById('imagesGrid').innerHTML = '';
                selectedFiles = [];
            } else {
                document.getElementById('extractBox').classList.remove('show');
                selectedFile2 = null;
            }
            
            const btn = document.getElementById(`createBtn${num}`);
            btn.disabled = false;
        }

        function handleFileSelect(files, num) {
            if (!files || files.length === 0) return;

            resetUI(num);

            if (num === 1) {
                const imageExts = ['jpg', 'jpeg', 'png', 'gif'];
                const firstExt = files[0].name.split('.').pop().toLowerCase();
                
                if (imageExts.includes(firstExt)) {
                    if (files.length > 10000) {
                        showMessage(1, '✗ Maximum 10000 images allowed!', true);
                        return;
                    }
                    
                    selectedFiles = Array.from(files);
                    document.getElementById('fileName1').textContent = `${files.length} images selected`;
                    
                    let totalSize = 0;
                    files.forEach(f => totalSize += f.size);
                    document.getElementById('fileSize1').textContent = formatFileSize(totalSize);
                    
                    displayImages(files);
                } else {
                    if (files.length > 1) {
                        showMessage(1, '✗ Only one document file at a time!', true);
                        return;
                    }
                    selectedFiles = [files[0]];
                    document.getElementById('fileName1').textContent = '📎 ' + files[0].name;
                    document.getElementById('fileSize1').textContent = formatFileSize(files[0].size);
                }
                
                document.getElementById('qualityBox').classList.add('show');
            } else {
                selectedFile2 = files[0];
                document.getElementById('fileName2').textContent = '📎 ' + files[0].name;
                document.getElementById('fileSize2').textContent = formatFileSize(files[0].size);
                document.getElementById('extractBox').classList.add('show');
            }

            document.getElementById(`fileInfo${num}`).classList.add('show');
            document.getElementById(`nameSection${num}`).classList.add('show');
            document.getElementById(`createBtn${num}`).classList.add('show');
            document.getElementById(`newFileBtn${num}`).classList.add('show');
        }

        function displayImages(files) {
            const grid = document.getElementById('imagesGrid');
            grid.innerHTML = '';
            
            const maxShow = Math.min(files.length, 50);
            
            for (let i = 0; i < maxShow; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const div = document.createElement('div');
                    div.className = 'image-item';
                    div.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <button class="remove-img" data-index="${i}">×</button>
                    `;
                    
                    div.querySelector('.remove-img').addEventListener('click', function(event) {
                        event.stopPropagation();
                        removeImage(parseInt(this.getAttribute('data-index')));
                    });
                    
                    grid.appendChild(div);
                };
                
                reader.readAsDataURL(file);
            }
            
            if (files.length > 50) {
                const info = document.createElement('div');
                info.style.gridColumn = '1 / -1';
                info.style.textAlign = 'center';
                info.style.padding = '15px';
                info.style.color = '#64748b';
                info.style.fontWeight = '600';
                info.textContent = `+ ${files.length - 50} more images`;
                grid.appendChild(info);
            }
        }

        function removeImage(index) {
            selectedFiles.splice(index, 1);
            if (selectedFiles.length === 0) {
                resetUI(1);
            } else {
                handleFileSelect(selectedFiles, 1);
            }
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        function showMessage(num, msg, isError = false) {
            const box = document.getElementById(`message${num}`);
            box.className = 'message-box show ' + (isError ? 'error' : 'success');
            box.textContent = msg;
        }

        function getOutputName(num, defaultName, ext) {
            const val = document.getElementById(`outputName${num}`).value.trim();
            
            if (val) {
                return val.endsWith(ext) ? val : val + ext;
            }
            
            return `ToolRoom_${defaultName}${ext}`;
        }

        function downloadFile(blob, filename) {
            try {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
                
                return true;
            } catch (error) {
                console.error('Download error:', error);
                return false;
            }
        }

        async function convertToPdf() {
            if (!selectedFiles || selectedFiles.length === 0) return;

            const loading = document.getElementById('loading1');
            const btn = document.getElementById('createBtn1');
            
            btn.disabled = true;
            loading.classList.add('show');
            btn.style.display = 'none';

            try {
                const ext = selectedFiles[0].name.split('.').pop().toLowerCase();
                const imageExts = ['jpg', 'jpeg', 'png', 'gif'];

                if (ext === 'docx') {
                    await convertWordToPdf(selectedFiles[0]);
                } else if (ext === 'xlsx' || ext === 'xls') {
                    await convertExcelToPdf(selectedFiles[0]);
                } else if (imageExts.includes(ext)) {
                    await convertImagesToPdf(selectedFiles);
                } else {
                    throw new Error('Unsupported file format');
                }

                showMessage(1, '✓ Successfully created! Check your downloads.');
            } catch (error) {
                console.error('Error:', error);
                showMessage(1, '✗ Error: ' + error.message, true);
            } finally {
                loading.classList.remove('show');
                btn.style.display = 'block';
                btn.disabled = false;
            }
        }

        async function extractFromPdf() {
            if (!selectedFile2) return;

            const loading = document.getElementById('loading2');
            const btn = document.getElementById('createBtn2');
            
            btn.disabled = true;
            loading.classList.add('show');
            btn.style.display = 'none';

            try {
                if (extractFormat === 'text') {
                    await extractToText();
                } else if (extractFormat === 'word') {
                    await extractToWord();
                } else if (extractFormat === 'excel') {
                    await extractToExcel();
                } else if (extractFormat === 'images') {
                    await extractImages();
                }
                
                showMessage(2, '✓ Successfully extracted! Check your downloads.');
            } catch (error) {
                console.error('Error:', error);
                showMessage(2, '✗ Error: ' + error.message, true);
            } finally {
                loading.classList.remove('show');
                btn.style.display = 'block';
                btn.disabled = false;
            }
        }

        function getQualitySettings() {
            switch(qualityLevel) {
                case 'ultra':
                    return { fontSize: 14, lineHeight: 8, imageQuality: 1.0, compression: 'NONE' };
                case 'high':
                    return { fontSize: 12, lineHeight: 7, imageQuality: 0.95, compression: 'FAST' };
                default:
                    return { fontSize: 11, lineHeight: 6, imageQuality: 0.85, compression: 'MEDIUM' };
            }
        }

        async function convertWordToPdf(file) {
            const arrayBuffer = await file.arrayBuffer();
            const result = await mammoth.extractRawText({ arrayBuffer });
            const text = result.value;

            if (!text || text.trim().length === 0) {
                throw new Error('No text content found');
            }

            const settings = getQualitySettings();
            const pdf = new jsPDF({
                compress: settings.compression !== 'NONE'
            });
            
            const pageHeight = pdf.internal.pageSize.getHeight();
            const pageWidth = pdf.internal.pageSize.getWidth();
            const margin = 25;
            const maxLineWidth = pageWidth - 2 * margin;
            
            pdf.setFontSize(settings.fontSize);
            const lines = pdf.splitTextToSize(text, maxLineWidth);
            let y = margin;

            for (let i = 0; i < lines.length; i++) {
                if (y + settings.lineHeight > pageHeight - margin) {
                    pdf.addPage();
                    y = margin;
                }
                pdf.text(lines[i], margin, y);
                y += settings.lineHeight;
            }

            const blob = pdf.output('blob');
            const filename = getOutputName(1, 'Document', '.pdf');
            
            if (!downloadFile(blob, filename)) {
                throw new Error('Failed to download');
            }
        }

        async function convertExcelToPdf(file) {
            const data = await file.arrayBuffer();
            const workbook = XLSX.read(data, { type: 'array' });
            
            const settings = getQualitySettings();
            const pdf = new jsPDF({
                orientation: 'landscape',
                compress: settings.compression !== 'NONE'
            });
            
            let isFirst = true;
            
            // Convert ALL sheets
            for (let sheetName of workbook.SheetNames) {
                const sheet = workbook.Sheets[sheetName];
                
                if (!sheet['!ref']) continue;
                
                const range = XLSX.utils.decode_range(sheet['!ref']);
                
                if (!isFirst) {
                    pdf.addPage();
                }
                isFirst = false;
                
                const pageHeight = pdf.internal.pageSize.getHeight();
                const pageWidth = pdf.internal.pageSize.getWidth();
                const margin = 10;
                let y = margin + 12;
                
                // Sheet title
                pdf.setFontSize(14);
                pdf.setFont(undefined, 'bold');
                pdf.text(sheetName, margin, margin + 8);
                pdf.setFont(undefined, 'normal');
                
                const numCols = range.e.c - range.s.c + 1;
                const availableWidth = pageWidth - 2 * margin;
                
                // Calculate optimal column widths based on content
                const colWidths = [];
                const maxColWidth = availableWidth / numCols;
                const minColWidth = 20;
                
                pdf.setFontSize(9);
                
                // Analyze each column to find max content width
                for (let col = range.s.c; col <= range.e.c; col++) {
                    let maxWidth = minColWidth;
                    
                    for (let row = range.s.r; row <= range.e.r; row++) {
                        const cellAddress = XLSX.utils.encode_cell({ r: row, c: col });
                        const cell = sheet[cellAddress];
                        if (cell) {
                            const cellValue = String(cell.v);
                            const textWidth = pdf.getTextWidth(cellValue) + 4;
                            if (textWidth > maxWidth) {
                                maxWidth = textWidth;
                            }
                        }
                    }
                    
                    // Limit to reasonable width
                    colWidths.push(Math.min(maxWidth, maxColWidth));
                }
                
                // Adjust widths if total exceeds available width
                let totalWidth = colWidths.reduce((a, b) => a + b, 0);
                if (totalWidth > availableWidth) {
                    const scale = availableWidth / totalWidth;
                    for (let i = 0; i < colWidths.length; i++) {
                        colWidths[i] *= scale;
                    }
                }
                
                const rowHeight = 6;
                
                // Draw all rows
                for (let row = range.s.r; row <= range.e.r; row++) {
                    // Check if new page needed
                    if (y + rowHeight > pageHeight - margin) {
                        pdf.addPage();
                        y = margin;
                    }
                    
                    let x = margin;
                    
                    // Draw all columns in this row
                    for (let col = range.s.c; col <= range.e.c; col++) {
                        const colIndex = col - range.s.c;
                        const colWidth = colWidths[colIndex];
                        
                        const cellAddress = XLSX.utils.encode_cell({ r: row, c: col });
                        const cell = sheet[cellAddress];
                        const cellValue = cell ? String(cell.v) : '';
                        
                        // Draw cell border
                        pdf.rect(x, y, colWidth, rowHeight);
                        
                        // Draw full text (no truncation)
                        const padding = 2;
                        const maxTextWidth = colWidth - padding * 2;
                        
                        // Split text into multiple lines if needed
                        const lines = pdf.splitTextToSize(cellValue, maxTextWidth);
                        
                        // Draw first line (or wrap to next row if multiline needed)
                        if (lines.length > 0) {
                            pdf.text(lines[0], x + padding, y + 4);
                        }
                        
                        x += colWidth;
                    }
                    
                    y += rowHeight;
                }
            }

            const blob = pdf.output('blob');
            const filename = getOutputName(1, 'Spreadsheet', '.pdf');
            
            if (!downloadFile(blob, filename)) {
                throw new Error('Failed to download');
            }
        }

        async function convertImagesToPdf(files) {
            const settings = getQualitySettings();
            const pdf = new jsPDF({
                compress: settings.compression !== 'NONE'
            });
            
            let isFirst = true;
            
            for (let file of files) {
                const imgData = await loadImage(file);
                
                if (!isFirst) {
                    pdf.addPage();
                }
                isFirst = false;
                
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 10;
                const maxWidth = pageWidth - 2 * margin;
                const maxHeight = pageHeight - 2 * margin;
                
                let imgWidth = imgData.width;
                let imgHeight = imgData.height;
                
                const widthRatio = maxWidth / imgWidth;
                const heightRatio = maxHeight / imgHeight;
                const ratio = Math.min(widthRatio, heightRatio);
                
                imgWidth = imgWidth * ratio;
                imgHeight = imgHeight * ratio;
                
                const xPos = (pageWidth - imgWidth) / 2;
                const yPos = (pageHeight - imgHeight) / 2;
                
                const format = file.type.includes('png') ? 'PNG' : 'JPEG';
                pdf.addImage(imgData.dataUrl, format, xPos, yPos, imgWidth, imgHeight, undefined, settings.imageQuality === 1.0 ? 'NONE' : 'FAST');
            }
            
            const blob = pdf.output('blob');
            const filename = getOutputName(1, 'Images', '.pdf');
            
            if (!downloadFile(blob, filename)) {
                throw new Error('Failed to download');
            }
        }

        function loadImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        resolve({
                            width: img.width,
                            height: img.height,
                            dataUrl: e.target.result
                        });
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        async function extractToText() {
            const arrayBuffer = await selectedFile2.arrayBuffer();
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let textContent = '';

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const text = await page.getTextContent();
                const pageText = text.items.map(item => item.str).join(' ');
                textContent += `========== Page ${i} ==========\n${pageText}\n\n`;
            }

            if (!textContent || textContent.trim().length === 0) {
                throw new Error('No text found in PDF');
            }

            const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
            const filename = getOutputName(2, 'Extracted', '.txt');
            
            if (!downloadFile(blob, filename)) {
                throw new Error('Failed to download');
            }
        }

        async function extractToWord() {
            const arrayBuffer = await selectedFile2.arrayBuffer();
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let textContent = '';

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                
                // Group by Y position to maintain structure
                const rowMap = new Map();
                
                content.items.forEach(item => {
                    const y = Math.round(item.transform[5] / 2) * 2;
                    if (!rowMap.has(y)) {
                        rowMap.set(y, []);
                    }
                    rowMap.get(y).push({
                        text: item.str.trim(),
                        x: Math.round(item.transform[4])
                    });
                });
                
                // Sort rows top to bottom
                const sortedRows = Array.from(rowMap.entries())
                    .sort((a, b) => b[0] - a[0]);
                
                textContent += `\n========== Page ${i} ==========\n\n`;
                
                for (const [y, items] of sortedRows) {
                    // Sort items left to right
                    items.sort((a, b) => a.x - b.x);
                    
                    // Detect if items should be on same line or separate
                    let line = '';
                    let lastX = -1000;
                    
                    for (const item of items) {
                        if (item.x - lastX > 50) {
                            // Add spacing for columns
                            line += '    ';
                        } else if (item.x - lastX > 10) {
                            // Normal space
                            line += ' ';
                        }
                        line += item.text;
                        lastX = item.x + item.text.length * 5;
                    }
                    
                    if (line.trim()) {
                        textContent += line + '\n';
                    }
                }
                
                textContent += '\n';
            }

            if (!textContent || textContent.trim().length === 0) {
                throw new Error('No text found in PDF');
            }

            const docContent = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<?mso-application progid="Word.Document"?>
<w:wordDocument xmlns:w="http://schemas.microsoft.com/office/word/2003/wordml">
<w:body>
<w:p><w:r><w:t>${textContent.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</w:t></w:r></w:p>
</w:body>
</w:wordDocument>`;

            const blob = new Blob([docContent], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
            const filename = getOutputName(2, 'Extracted', '.doc');
            
            if (!downloadFile(blob, filename)) {
                throw new Error('Failed to download');
            }
        }

        async function extractToExcel() {
            const arrayBuffer = await selectedFile2.arrayBuffer();
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const wb = XLSX.utils.book_new();

            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                const page = await pdf.getPage(pageNum);
                const textContent = await page.getTextContent();
                
                // Group items by Y position (rows)
                const rowMap = new Map();
                
                textContent.items.forEach(item => {
                    const y = Math.round(item.transform[5] / 2) * 2; // Group similar Y positions
                    if (!rowMap.has(y)) {
                        rowMap.set(y, []);
                    }
                    rowMap.get(y).push({
                        text: item.str.trim(),
                        x: Math.round(item.transform[4])
                    });
                });
                
                // Sort rows by Y position (top to bottom)
                const sortedRows = Array.from(rowMap.entries())
                    .sort((a, b) => b[0] - a[0]);
                
                // Process each row
                const sheetData = [];
                
                for (const [y, items] of sortedRows) {
                    // Sort items in row by X position (left to right)
                    items.sort((a, b) => a.x - b.x);
                    
                    // Detect columns by X position clustering
                    const columns = [];
                    let currentCol = [];
                    let lastX = -1000;
                    
                    for (const item of items) {
                        // If X position is far from last, it's a new column
                        if (item.x - lastX > 10 && currentCol.length > 0) {
                            columns.push(currentCol.join(' '));
                            currentCol = [];
                        }
                        currentCol.push(item.text);
                        lastX = item.x;
                    }
                    
                    // Add last column
                    if (currentCol.length > 0) {
                        columns.push(currentCol.join(' '));
                    }
                    
                    // Only add non-empty rows
                    if (columns.some(col => col.trim())) {
                        sheetData.push(columns);
                    }
                }
                
                if (sheetData.length > 0) {
                    const ws = XLSX.utils.aoa_to_sheet(sheetData);
                    XLSX.utils.book_append_sheet(wb, ws, `Page ${pageNum}`);
                }
            }

            if (wb.SheetNames.length === 0) {
                throw new Error('No data found in PDF');
            }

            const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
            const blob = new Blob([wbout], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
            const filename = getOutputName(2, 'Extracted', '.xlsx');
            
            if (!downloadFile(blob, filename)) {
                throw new Error('Failed to download');
            }
        }

        async function extractImages() {
            const arrayBuffer = await selectedFile2.arrayBuffer();
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const zip = new JSZip();
            let imageCount = 0;

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 2.0 });
                const canvas = document.createElement('canvas');
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                const ctx = canvas.getContext('2d');
                
                await page.render({
                    canvasContext: ctx,
                    viewport: viewport
                }).promise;
                
                const dataUrl = canvas.toDataURL('image/png');
                const base64Data = dataUrl.split(',')[1];
                
                zip.file(`page_${i}.png`, base64Data, { base64: true });
                imageCount++;
            }

            if (imageCount === 0) {
                throw new Error('No pages found');
            }

            const zipBlob = await zip.generateAsync({ type: 'blob' });
            const filename = getOutputName(2, 'Images', '.zip');
            
            if (!downloadFile(zipBlob, filename)) {
                throw new Error('Failed to download');
            }
        }
    </script>
</body>
</html>
